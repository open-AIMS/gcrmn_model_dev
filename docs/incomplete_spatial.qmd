---
title: "Comparing model types - incomplete spatial"
author: "Murray Logan"
date: today
date-format: "DD/MM/YYYY"
format:
  html:
    ## Format
    theme: [default, resources/style.scss]
    css: resources/style.css
    html-math-method: mathjax
    ## Table of contents
    toc: true
    toc-float: true
    ## Numbering
    number-sections: true
    number-depth: 3
    ## Layout
    page-layout: full
    fig-caption-location: "bottom"
    fig-align: "center"
    fig-width: 4
    fig-height: 4
    out-width: 500px
    fig-dpi: 72
    tbl-cap-location: top
    ## Code
    code-fold: false
    code-tools: true
    code-summary: "Show the code"
    code-line-numbers: true
    code-block-border-left: "#ccc"
    code-copy: true
    highlight-style: atom-one
    ## Execution
    execute:
      echo: true
      #cache: true
    ## Rendering
    embed-resources: true
crossref:
  fig-title: '**Figure**'
  fig-labels: arabic
  tbl-title: '**Table**'
  tbl-labels: arabic
engine: knitr
## execute: 
##   cache: true
jupyter: python3
output_dir: "docs"
documentclass: article
fontsize: 12pt
mainfont: Arial
mathfont: LiberationMono
monofont: DejaVu Sans Mono
classoption: a4paper
bibliography: resources/references.bib
---

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(
    cache.lazy = FALSE,
    tidy = "styler"
)
## allow indented chunks
assignInNamespace(".sep.label",
  "^\\ *(#|--)+\\s*(@knitr|----+)(.*?)-*\\s*$",
    ns = "knitr"
)
knitr::read_chunk("../R/site_replacement.R")
knitr::read_chunk("../R/incomplete_spatial.R")
knitr::read_chunk("../python/incomplete_spatial.py")
## remove the indentation from all python chunks that start
## with indentation
codes <- knitr::knit_code$get()
process_chunks <- function(codes) {
  nms <- names(codes)
  wch <- which(startsWith(names(codes), "python"))
  codes1 <- lapply(1:length(codes), function(i) {
    if (i %in% wch) {
      x <- gsub("^ {4}", "", codes[[i]])
    } else {
      x <- codes[[i]]
    }
    x
  })
  names(codes1) <- nms
  codes1
}
knitr::knit_code$set(
  process_chunks(codes)
)
```

```{css, echo=FALSE}
figcaption {
  text-align: left !important;
}
```

## Purpose

The primary purpose of this page is to contrast and evaluate the
ability of various models to represent the temporal trends of an
unsampled area based on training from a neighbouring area. In testing
this scenario, we will also explore how this ability varies with the
number of locations on which the models are trained.

The specific incomplete spatial scenarios were:

- using an area with extensive spatial sampling coverage (**Northern**) to
  predict:
  - the cover in same area
  - the cover in an other adjacent area (**Southern**) with similar cover to the
    (**Northern**)
- using an area with very sparse spatial sampling coverage (**Southern**)
  to predict:
  - the cover in same area
  - the cover in an other adjacent area (**Northern**) with similar cover to the
    (**Southern**)
- using an area with extensive spatial sampling coverage (**Western**) to
  predict:
  - the cover in same area
  - the cover in an other adjacent area (**Eastern**) with substantially higher
    cover to the (**Western**)

The candidate models are:

- `glmmTMB` - very fast frequentist GLMM (not a serious candidate, but
  included due to general familiarity to many practitioners)
- `brms` - an interface to fit Bayesian generalized (non-)linear
  multivariate multilevel models using Stan
- `stan` - a bespoke Stan model I wrote for the previous GCRMN report
- `gbm` - simple gradient boosted regression model
- `xgboost` - modern gradient boosted regression model
- `dbarts` - simple Bayesian additive regression tree
- `pymc_bart` - Bayesian additive regression tree extension to `pymc`
  (a probabilistic python library for building Bayesian models)

## Conclusions

Unfortunately, there was no standout model that consistently
outperformed or even consistently ranked amongst the highest
performers across the different incomplete spatial scenarios.

::: {.callout-note collapse=true}
### View summary of MSE

:::: {.panel-tabset}

#### Northern models

::::: {#fig-mse_12_1}
![](../output/figures/mse_12_1.png){width=800px}

Mean square error (MSE) of models build on Northern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Northern reefs, all Southern reefs or
only the sampled Northern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::::

#### Southern models

::::: {#fig-mse_13_1}
![](../output/figures/mse_13_1.png){width=800px}

Mean square error (MSE) of models build on Southern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Southern reefs, all Northern reefs or
only the sampled Southern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::::


#### Western models

::::: {#fig-mse_16_1}
![](../output/figures/mse_16_1.png){width=800px}

Mean square error (MSE) of models build on Western reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Western reefs, all Eastern reefs or
only the sampled Western reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::::

#### Eastern models

::::: {#fig-mse_17_1}
![](../output/figures/mse_17_1.png){width=800px}

Mean square error (MSE) of models build on Eastern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Eastern reefs, all Western reefs or
only the sampled Eastern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::::


::::
:::

1. Models with covaratiates typically performed slightly better (lower
   MSE and Inaccuracy) than the same models without covariates with
   some exceptions (the tree models when predicting Northern reefs
   from Northern models and the non-tree models when predicting from
   the Southern model)

2. Models without covariates typically performed better at predicting
   the sample/training data than they did predicting data from the 
   broader area or the other area - not at all that surprising!
   
::: {.callout-note collapse=true}
### View a selection of models

::: {.columns}
:::: {.column width="33%"}
Stan (predicting Northern sample data)<br>
![](../output/figures/R_pdp_1_mod_stan_12.png){width=300px}<br><br>
dbarts (predicting Northern sample data)<br>
![](../output/figures/R_pdp_1_mod_dbarts_12.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
Stan (predicting Northern reefs)<br>
![](../output/figures/R_pdp_2_mod_stan_12.png){width=300px}<br><br>
dbarts (predicting Northern reefs)<br>
![](../output/figures/R_pdp_2_mod_dbarts_12.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
Stan (predicting Southern reefs)<br>
![](../output/figures/R_pdp_3_mod_stan_12.png){width=300px}<br><br>
dbarts (predicting Southern reefs)<br>
![](../output/figures/R_pdp_3_mod_dbarts_12.png){width=300px}<br><br>
::::
:::
:::
3. Models with covariates also typically performed better at
   predicting the sample/traing data than data from either the
   broader area or the other area -
   notable exceptions being `brms` and `glmmTMB` for models built from
   sparse data (e.g. Southern and Eastern models).

::: {.callout-note collapse=true}
### View a selection of Northern models

::: {.columns}
:::: {.column width="33%"}
brms (predicting Northern sample data)<br>
![](../output/figures/R_pdp_1_mod_brms_12b.png){width=300px}<br><br>
dbarts (predicting Northern sample data)<br>
![](../output/figures/R_pdp_1_mod_dbarts_12b.png){width=300px}<br><br>
pymc-bart (predicting Northern sample data)<br>
![](../output/figures/python_pdp_1_mod_pymc_bart_12b.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
brms (predicting Northern reefs)<br>
![](../output/figures/R_pdp_2_mod_brms_12b.png){width=300px}<br><br>
dbarts (predicting Northern reefs)<br>
![](../output/figures/R_pdp_2_mod_dbarts_12b.png){width=300px}<br><br>
pymc-bart (predicting Northern reefs)<br>
![](../output/figures/python_pdp_2_mod_pymc_bart_12b.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
brms (predicting Southern reefs)<br>
![](../output/figures/R_pdp_3_mod_brms_12b.png){width=300px}<br><br>
dbarts (predicting Southern reefs)<br>
![](../output/figures/R_pdp_3_mod_dbarts_12b.png){width=300px}<br><br>
pymc-bart (predicting Southern reefs)<br>
![](../output/figures/python_pdp_3_mod_pymc_bart_12b.png){width=300px}<br><br>
::::
:::
:::
::: {.callout-note collapse=true}
### View a selection of Western models

::: {.columns}
:::: {.column width="33%"}
brms (predicting Western sample data)<br>
![](../output/figures/R_pdp_1_mod_brms_16b.png){width=300px}<br><br>
dbarts (predicting Western sample data)<br>
![](../output/figures/R_pdp_1_mod_dbarts_16b.png){width=300px}<br><br>
pymc-bart (predicting Western sample data)<br>
![](../output/figures/python_pdp_1_mod_pymc_bart_16b.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
brms (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_brms_16b.png){width=300px}<br><br>
dbarts (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_dbarts_16b.png){width=300px}<br><br>
pymc-bart (predicting Western reefs)<br>
![](../output/figures/python_pdp_2_mod_pymc_bart_16b.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
brms (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_brms_16b.png){width=300px}<br><br>
dbarts (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_dbarts_16b.png){width=300px}<br><br>
pymc-bart (predicting Eastern reefs)<br>
![](../output/figures/python_pdp_3_mod_pymc_bart_16b.png){width=300px}<br><br>
::::
:::
:::

4. When predicting to an area with very different cover (e.g
   predicting Eastern from Western models), tree models with
   covariates performed substantially worse than linear models - the
   reason for this is currently elusive

::: {.callout-note collapse=true}
### View a selection of Western models predicting All Eastern reefs

::: {.columns}
:::: {.column width="33%"}
brms (without covariates)<br>
![](../output/figures/R_pdp_3_mod_brms_16.png){width=300px}<br><br>
dbarts (without covariates)<br>
![](../output/figures/R_pdp_3_mod_dbarts_16.png){width=300px}<br><br>
gbm (without covariates)<br>
![](../output/figures/R_pdp_3_mod_gbm_16.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
brms (with covariates)<br>
![](../output/figures/R_pdp_3_mod_brms_16b.png){width=300px}<br><br>
dbarts (with covariates)<br>
![](../output/figures/R_pdp_3_mod_dbarts_16b.png){width=300px}<br><br>
gbm (with covariates)<br>
![](../output/figures/R_pdp_3_mod_gbm_16b.png){width=300px}<br><br>
::::
:::
:::

5. When the sample data does not well represent the area (E.g.
   Northern samples), all models yield predictions that do not well
   reflect the true cover regardless of whether or not the 
   models include covariates or not.

::: {.callout-note collapse=true}
### View a selection of Northern models predicting All Northern reefs

::: {.columns}
:::: {.column width="33%"}
Stan model<br>
![](../output/figures/R_pdp_2_mod_stan_12.png){width=300px}
::::
:::: {.column width="33%"}
xgboost model<br>
![](../output/figures/R_pdp_2_mod_xgboost_12b.png){width=300px}
::::
:::: {.column width="33%"}
pymc-bart model<br>
![](../output/figures/python_pdp_2_mod_pymc_bart_12b.png){width=300px}
::::
:::
:::

6. When the number of reefs in the sample is relatively large (25):
   - all models have similar ability to represent the domain from
     which the sample data were drawn (regardless of whether
     covariates are included)
   - models with covariates were only very slightly better at representing new
     domains
   - interestingly, for models with covariates, generally the
     heirarchical models outperformed the tree models (with the
     possible exception of pymc-bart)
7. When the number of reefs in the sample is small (2):
   - no models performed that well at predicting the unsampled area
   - tree models with covariates did not perform better than the equivalent
     tree models without covariates at predicting to either the broader area
     or the other area
   - linear models tended to have higher uncertainty estimates that are 
     potentially more reflective of the level of confidence in the estimates.

::: {.callout-note collapse=true}
### View a selection of Eastern models

::: {.columns}
:::: {.column width="33%"}
dbarts (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_dbarts_17.png){width=300px}<br><br>
dbarts (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_dbarts_17.png){width=300px}<br><br>
brms (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_brms_17.png){width=300px}<br><br>
brms (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_brms_17.png){width=300px}<br><br>
::::
:::: {.column width="33%"}
dbarts + covariates (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_dbarts_17b.png){width=300px}<br><br>
dbarts + covariates (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_dbarts_17b.png){width=300px}<br><br>
brms + covariates (predicting Western reefs)<br>
![](../output/figures/R_pdp_2_mod_brms_17b.png){width=300px}<br><br>
brms + covariates (predicting Eastern reefs)<br>
![](../output/figures/R_pdp_3_mod_brms_17b.png){width=300px}<br><br>
::::
:::
:::


## Preparations

::: {.panel-tabset}
  
### R

```{r}
#| label: cwd
#| eval: false
#| echo: false
#| warning: false
#| message: false
#| cache: false
getwd()
```

Load the necessary R libraries

```{r}
#| label: site replacement libraries
#| output: false
#| eval: true
#| warning: false
#| message: false
#| cache: false
```

Establish the global environment and paths

```{r}
#| label: site replacement global parameters
#| results: hide
#| eval: true
#| echo: true
#| cache: false
```

Load any helper functions

```{r}
#| label: site replacement functions
#| results: hide
#| eval: false
#| echo: true
#| cache: false
```

### Python

```{python}
#| label: python incomplete spatial libraries
#| output: false
#| eval: true
#| warning: false
#| message: false
#| cache: false
```

```{python}
#| label: python incomplete spatial global parameters
#| results: hide
#| eval: true
#| echo: true
#| cache: false
```
:::


## Import data

::: {.panel-tabset}

### R

:::: {.panel-tabset}

#### Full reef level spatio-temporal benthic data

These data represent the synthesized "truth" and are thereby useful to
compare to the various modelled outcomes.

![](../output/figures/R_all_temporal_summary_plot.png){width=500px}

```{r}
#| label: read all reefs data
#| results: markup
#| eval: true
#| echo: true
#| cache: true
```

```{r}
#| label: read all reefs data show
#| results: markup
#| eval: true
#| echo: true
#| cache: true
#| dependson: "read all reefs data"
#| code-fold: false
benthos_reefs_sf 
```

```{r}
#| label: all reefs temporal summary
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: all reefs temporal summary plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read all reefs data"
```

#### All Northern reefs

These data represent the all Northern reefs.

```{r}
#| label: read sampled reefs data 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_10_plot.png){width=500px}
::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 10 plot 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 10"
```

::::
:::


![](../output/figures/R_all_temporal_summary_plot_10.png){width=500px}

```{r}
#| label: read sampled reefs data 10 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 10"
```
#### All Southern reefs

These data represent the all Southern reefs.

```{r}
#| label: read sampled reefs data 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_11_plot.png){width=500px}
::::
:::: {.column width="50%"}

```{r}
#| label: read sampled reefs data 11 plot 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 11"
```
::::
:::: {.column width="50%"}

::::
:::

![](../output/figures/R_all_temporal_summary_plot_11.png){width=500px}


```{r}
#| label: read sampled reefs data 11 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 10"
```

#### Northern sampled reefs

These data represent the Northern sampled reefs.

```{r}
#| label: read sampled reefs data 12
#| results: markup
#| eval: true
#| echo: true
#| cache: true
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_12_plot.png){width=500px}

::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 12 plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 12"
```
::::
:::
![](../output/figures/R_all_temporal_summary_plot_12.png){width=500px}

```{r}
#| label: read sampled reefs data 12 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 12"
```

#### Southern sampled reefs

These data represent the Southern sampled reefs.

```{r}
#| label: read sampled reefs data 13
#| results: markup
#| eval: true
#| echo: true
#| cache: true
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_sampled_reefs_13_plot.png){width=500px}
::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 13 plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 13"
```

::::
:::
![](../output/figures/R_all_temporal_summary_plot_13.png){width=500px}


```{r}
#| label: read sampled reefs data 13 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 13"
```

#### All Western reefs

These data represent the all Western reefs.

```{r}
#| label: read sampled reefs data 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_14_plot.png){width=500px}
::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 14 plot 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 14"
```

::::
:::


![](../output/figures/R_all_temporal_summary_plot_14.png){width=500px}

```{r}
#| label: read sampled reefs data 14 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 14"
```
#### Western sampled reefs

These data represent the Western sampled reefs.

```{r}
#| label: read sampled reefs data 16
#| results: markup
#| eval: true
#| echo: true
#| cache: true
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_16_plot.png){width=500px}

::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 16 plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 16"
```
::::
:::
![](../output/figures/R_all_temporal_summary_plot_16.png){width=500px}

```{r}
#| label: read sampled reefs data 16 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 16"
```

#### All Eastern reefs

These data represent the all Eastern reefs.

```{r}
#| label: read sampled reefs data 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_15_plot.png){width=500px}
::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 15 plot 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 15"
```

::::
:::

 
![](../output/figures/R_all_temporal_summary_plot_15.png){width=500px}

```{r}
#| label: read sampled reefs data 15 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 15"
```
#### Eastern sampled reefs

These data represent the Eastern sampled reefs.

```{r}
#| label: read sampled reefs data 17
#| results: markup
#| eval: true
#| echo: true
#| cache: true
#| code-fold: true
```

::: {.columns}
:::: {.column width="50%"}

![](../output/figures/R_sampled_reefs_17_plot.png){width=500px}

::::
:::: {.column width="50%"}
```{r}
#| label: read sampled reefs data 17 plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 17"
```
::::
:::
![](../output/figures/R_all_temporal_summary_plot_17.png){width=500px}

```{r}
#| label: read sampled reefs data 17 plot 2 
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 17"
```
 
::::
   
### Python

:::: {.panel-tabset}

#### Full reef level spatio-temporal benthic data

These data represent the synthesized "truth" and are thereby useful to
compare to the various modelled outcomes.

![](../output/figures/Python_all_temporal_summary_plot.png){width=500px}

```{python}
#| label: python incomplete spatial read all reefs data 
#| results: markup
#| eval: true
#| echo: true
#| cache: true
```
 
```{python}
#| label: python incomplete spatial read all reefs data show 
#| results: markup
#| eval: false
#| echo: true
#| cache: true
#| dependson: "python incomplete spatial read all reefs data"
#| code-fold: false
```

```{python}
#| label: python incomplete spatial all reefs temporal summary
#| results: markup
#| eval: false
#| echo: true
#| cache: true
#| code-fold: true
```

```{python}
#| label: python incomplete spatial all reefs temporal summary plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
```

#### All Northern reefs

These data represent all the Northern reefs.

![](../output/figures/Python_sampled_reefs_10_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_10_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 10 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 10 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### All Southern reefs

These data represent all the Southern reefs.

![](../output/figures/Python_sampled_reefs_11_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_11_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 11 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 11 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### Northern sampled reefs

These data represent all the Northern reefs.

![](../output/figures/Python_sampled_reefs_12_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_12_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 12 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 12 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### Southern sampled reefs

These data represent all the Southern reefs.

![](../output/figures/Python_sampled_reefs_13_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_13_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 13 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 13 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### All Western reefs

These data represent all the Northern reefs.

![](../output/figures/Python_sampled_reefs_14_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_14_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 14 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 14 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### Western sampled reefs

These data represent all the Western reefs.

![](../output/figures/Python_sampled_reefs_16_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_16_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 16 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 16 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### All Eastern reefs

These data represent all the Northern reefs.

![](../output/figures/Python_sampled_reefs_15_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_15_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 15 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 15 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

#### Eastern sampled reefs

These data represent all the Eastern reefs.

![](../output/figures/Python_sampled_reefs_17_plot_1.png){width=500px}
![](../output/figures/Python_sampled_reefs_17_plot_2.png){width=500px}

```{python}
#| label: python read sampled reefs data 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python read sampled reefs data 17 plot 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python read sampled reefs data 17 plot 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::

:::
  
## Data preparations

Perform the following data preparation steps:

- specifically declare any categorical variables (as factors in R,
  categories in python)
- ensure that all levels of hierarchical (varying) effects have unique
  IDs
- express cover as a proportion out of 1 as is necessary for modelling
  against a beta distribution
- create a prediction grid containing all years in the monitoring
  range
  
  
::: {.panel-tabset}

### R

:::: {.panel-tabset}

#### Northern reefs

```{r}
#| label: sampled data prep 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 10b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
#### Northern sampled reefs

```{r}
#| label: sampled data prep 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 12b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
#### Southern reefs

```{r}
#| label: sampled data prep 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 11b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Southern sampled reefs

```{r}
#| label: sampled data prep 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 13b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Western reefs

```{r}
#| label: sampled data prep 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 14b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Western sampled reefs

```{r}
#| label: sampled data prep 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 16b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Eastern reefs

```{r}
#| label: sampled data prep 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```
```{r}
#| label: newdata 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 15b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Eastern sampled reefs

```{r}
#| label: sampled data prep 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{r}
#| label: newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

::::

### Python

:::: {.panel-tabset}

#### All Northern reefs

```{python}
#| label: python sampled data prep 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 10
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 10b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### All Southern reefs

```{python}
#| label: python sampled data prep 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 11
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 11b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Northern sampled reefs

```{python}
#| label: python sampled data prep 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 12b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Southern sampled reefs

```{python}
#| label: python sampled data prep 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 13b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### All Western reefs

```{python}
#| label: python sampled data prep 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 14
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 14b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Western sampled reefs

```{python}
#| label: python sampled data prep 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 16b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### All Eastern reefs

```{python}
#| label: python sampled data prep 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 15
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 15b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

#### Eastern sampled reefs

```{python}
#| label: python sampled data prep 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```

```{python}
#| label: python sampled newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
```


::::

:::


## Modelled trends

The following table lists datasets that are used in the comparison
figures along with their respective legend entries.

::: {.callout-note collapse=true}
### view table
| Dataset                                   | Description                                            | Target                             |
|-------------------------------------------|--------------------------------------------------------|------------------------------------|
| benthos_fixed_locs_obs_10                 | All Northern Reefs, Reef+ level with covariates        | incomplete_spatial_data_prep_10_   |
| benthos_benthos_reefs_temporal_summary_10 | Annual mean/median for All Northern reefs              | read_sampled_reefs_data_10_plot_2_ |
| newdata_10                                | Just the sampling years for Northern                   | incomplete_spatial_newdata_10_     |
| newdata_10b                               | All Northern Reefs, Reef level with covariates         | incomplete_spatial_newdata_10b_    |
| benthos_fixed_locs_obs_11                 | All Southern Reefs, Reef+ level with covariates        | incomplete_spatial_data_prep_11_   |
| benthos_benthos_reefs_temporal_summary_11 | Annual mean/median for All Southern reefs              | read_sampled_reefs_data_11_plot_2_ |
| newdata_11                                | Just the sampling years for Southern                   | incomplete_spatial_newdata_11_     |
| newdata_11b                               | All Southern Reefs, Reef level with covariates         | incomplete_spatial_newdata_11b_    |
| benthos_fixed_locs_obs_12                 | Northern sampled Reefs, Transect level with covariates | incomplete_spatial_data_prep_12_   |
| benthos_benthos_reefs_temporal_summary_12 | Annual mean/median for Sampled Northern reefs          | read_sampled_reefs_data_12_plot_2_ |
| newdata_12                                | Just the sampling years for Northern                   | incomplete_spatial_newdata_12_     |
| newdata_12b                               | Sampling Reef/years for Northern                       | incomplete_spatial_newdata_12b_    |
| benthos_fixed_locs_obs_13                 | Southern sampled Reefs, Transect level with covariates | incomplete_spatial_data_prep_13_   |
| benthos_benthos_reefs_temporal_summary_13 | Annual mean/median for Sampled Southern reefs          | read_sampled_reefs_data_13_plot_2_ |
| newdata_13                                | Just the sampling years for Southern                   | incomplete_spatial_newdata_13_     |
| newdata_13b                               | Sampling Reef/years for Southern                       | incomplete_spatial_newdata_13b_    |
|                                           |                                                        |                                    |  
:::

Each of the sections below features a set of partial dependency plots.
These plots present the modelled temporal trends compared to a range
of other non-modelled estimates. The following table, defines each of
the trends presented throughout the partial plots. In the table,
**challenging data** refers to a dataset that has the focal modelling
challenge (for example, for the _Replace a reef_ issue, the
challenging data are observed data with a reef replacement.


| Trend                                                | Description                                                                       |
|------------------------------------------------------|-----------------------------------------------------------------------------------|
| `all mean`, `all median`, `true mean`, `true median` | Simple hierarchical means/medians for the full spatio-temporal grid (the "truth") |
| `all_sampled_ mean`, `all_sampled_ median`           | Simple hierarchical means/medians for the 25 sites / 12 years observational data  |
| `simple data mean`, `simple data median`             | Simple hierarchical means/medians for the **challenging data**                    |
| `glmmTMB`                                            | Modelled trends from a glmmTMB (frequentist) model                                |
| `brms`                                               | Modelled trends for a brms (Bayesian) model                                       |
| `stan`                                               | Modelled trends from a bespoke STAN (Bayesian) model                              |
| `gbm`                                                | Modelled trends from a Gradient Boosted Model (regression tree)                   |
| `dbarts`                                             | Modelled trends from a Bayesian Added Regression Tree                             |
| `xgboot`                                             | Modelled trends from a Gradient Boosted Model Tree                                |
| `pymc_bart`                                          | Modelled trends from a Bayesian Added Regression Tree                             |

Partial plots that display both a modelled trend as well as `simple
data mean` and `simple data median` allow us to compare how well the
model fits the training data.

Partial plots that display both a modelling trend as well as
`all_sampled_ mean`, `all_sampled_ median` and either `all mean`/`all
median` or `true mean`/`true median` allow us to compare the accuracy
of the model to both the full observed data and the full
spatio-temporal (truth) grid.

::: {.panel-tabset}

### Northern sampled reefs

:::: {.panel-tabset}

#### Data sets

:::::: {.panel-tabset .tabset-left}
   
##### benthos_fixed_locs_obs_12
These are the **data** used to **fit the model**

```{r}
#| label: glmmTMB_12 sample data
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_10
These are the temporal **summaries** from the **All Northern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_12 sample data summary 10
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_11
These are the temporal **summaries** from the **All Southern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_12 sample data summary 11
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### newdata_10

```{r}
#| label: glmmTMB_12 newdata 10
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_10b 

```{r}
#| label: glmmTMB_12 newdata 10b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_11

```{r}
#| label: glmmTMB_12 newdata 11
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
  
##### newdata_11b

```{r}
#| label: glmmTMB_12 newdata 11b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_12

```{r}
#| label: glmmTMB_12 newdata 12
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_12b

```{r}
#| label: glmmTMB_12 newdata 12b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_13

```{r}
#| label: glmmTMB_12 newdata 13
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_13b
```{r}
#| label: glmmTMB_12 newdata 13b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
::::::
#### glmmTMB

```{r}
#| label: glmmTMB_12
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: glmmTMB_12_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: glmmTMB_12_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: glmmTMB_12_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_12_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_12.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_12_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_12"
mod_glmmTMB_12 <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_12.rds")
)
mod_glmmTMB_12 |> summary()
```


:::::
 
#### glmmTMB + coveriates

```{r}
#| label: glmmTMB_12b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
         
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: glmmTMB_12b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Northern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: glmmTMB_12b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs
 
::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_12b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Southern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: glmmTMB_12b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_12b_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_12b.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_12b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_12b"
mod_glmmTMB_12b <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_12b.rds")
)
mod_glmmTMB_12b |> summary()
```

:::::


#### brms

```{r}
#| label: brms_pre_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_12
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: brms_12_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: brms_12_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: brms_12_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_trace_12.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_ac_12.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_rhat_12.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_ess_12.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_ppc_12.png){width=500px}

##### Summary

```{r}
#| label: brms_12_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
mod_brms_12 <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_12.rds")
)
mod_brms_12 |> summary()
```

:::::

#### brms + covariates

```{r}
#| label: brms_pre_12b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_12b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: brms_12b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: brms_12b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_12b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Southern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: brms_12b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_12b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12"
```

![](../output/figures/R_brms_trace_12b.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_12b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12b"
```

![](../output/figures/R_brms_ac_12b.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_12b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12b"
```

![](../output/figures/R_brms_rhat_12b.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_12b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_12b"
```

![](../output/figures/R_brms_ess_12b.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_12b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_12b"
```

![](../output/figures/R_brms_ppc_12b.png){width=500px}

##### Summary

```{r}
#| label: brms_12b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_12b"
mod_brms_12b <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_12b.rds")
)
mod_brms_12b |> summary()
```

:::::
 
#### stan

```{r}
#| label: stan_pre_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: stan_12
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 12"
```


::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_stan_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_12_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: stan_12_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_stan_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_12_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: stan_12_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_stan_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_12_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: stan_12_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: stan_trace_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
```

![](../output/figures/R_stan_trace_12.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: stan_ac_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
```

![](../output/figures/R_stan_ac_12.png){width=500px}

###### Rhat

```{r}
#| label: stan_rhat_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
```

![](../output/figures/R_stan_rhat_12.png){width=500px}

###### Effective sample size

```{r}
#| label: stan_ess_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
```

![](../output/figures/R_stan_ess_12.png){width=500px}

::::::

##### Model validation

```{r}
#| label: stan_ppc_12
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
```

![](../output/figures/R_stan_ppc_12.png){width=500px}

##### Summary

```{r}
#| label: stan_12_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "stan_12"
mod_stan_12 <- readRDS(
  file = paste0(data_path, "synthetic/mod_stan_12.rds")
)
mod_stan_12$print(
  variables = c("phi", "beta", "sd_1", "sd_2", "sd_3"),
  max_rows = 20
)
mod_stan_12$print(
  variables = "cellmeans",
  max_rows = 20
)
```

:::::

#### GBM

```{r}
#| label: gbm_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: gbm_12_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: gbm_12_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: gbm_12_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

:::::

#### GBM + covariates

```{r}
#| label: gbm_12b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_12b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: gbm_12b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

![](../output/figures/R_infl_mod_gbm_12b.png){width=350px}
  
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: gbm_12b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_12b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: gbm_12b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

:::::

#### dbarts

```{r}
#| label: dbarts_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: dbarts_pred_12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{r}
#| label: dbarts_12_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: dbarts_12_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_12.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: dbarts_12_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::

:::::

#### dbarts + covariates

```{r}
#| label: dbarts_12b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Northern sampled reefs**

```{r}
#| label: dbarts_12b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: dbarts_12b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_12b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: dbarts_12b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### xgboost + covariates

```{r}
#| label: xgboost_12_prep
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: xgboost_12_tune
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{r}
#| label: xgboost_12_fit
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_xgboost_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_12b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Northern sampled reefs**

```{r}
#| label: xgboost_12b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_xgboost_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_12b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: xgboost_12b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_xgboost_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_12b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: xgboost_12b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### pymc-bart + covariates

```{python}
#| label: python sampled data barts data 12
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data barts fit 12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_1_mod_pymc_bart_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 12
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Northern sampled reefs**
```{python}
#| label: python sampled data pymc_barts mse 12b 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_2_mod_pymc_bart_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 12 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 12 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{python}
#| label: python sampled data pymc_barts mse 12b 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_3_mod_pymc_bart_12b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 12 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 12 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{python}
#| label: python sampled data pymc_barts mse 12b 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::
   
##### Data sets

:::::: {.panel-tabset}

###### benthos_fixed_locs_obs_12

```{python}
#| label: python sampled data barts data 12 sample data
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

###### newdata_12b

```{python}
#| label: python sampled data barts data 12 newdata 12b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
###### newdata_13b

```{python}
#| label: python sampled data barts data 12 newdata 13b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::
:::::
 
#### Comparisons
     
```{r}
#| label: comparison_12
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: false
```
 
::: {#fig-mse_12_1}
![](../output/figures/mse_12_1.png){width=800px}

Mean square error (MSE) of models build on Northern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Northern reefs, all Southern reefs or
only the sampled Northern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

::: {#fig-mse_12_2}
![](../output/figures/mse_12_2.png){width=800px}

Mean inaccuracy (%) of models build on Northern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller inaccuracy since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Northern reefs, all Southern reefs or
only the sampled Northern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

```{r}
#| label: comparison_12_tab
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: false
comps_12 <- readRDS(file = paste0(data_path,
                                        "synthetic/comps_12.rds")
                          ) 
comps_12 |> knitr::kable()
```
      
::::
  
### Southern sampled reefs

:::: {.panel-tabset}

#### Data sets

:::::: {.panel-tabset .tabset-left}
   
##### benthos_fixed_locs_obs_11
These are the **data** used to **fit the model**

```{r}
#| label: glmmTMB_13 sample data
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_10
These are the temporal **summaries** from the **All Northern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_13 sample data summary 10
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_11
These are the temporal **summaries** from the **All Southern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**
 
```{r}
#| label: glmmTMB_13 sample data summary 11
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### newdata_10

```{r}
#| label: glmmTMB_13 newdata 10
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_10b 

```{r}
#| label: glmmTMB_13 newdata 10b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_11

```{r}
#| label: glmmTMB_13 newdata 11
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
  
##### newdata_11b

```{r}
#| label: glmmTMB_13 newdata 11b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_12

```{r}
#| label: glmmTMB_13 newdata 12
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_12b

```{r}
#| label: glmmTMB_13 newdata 12b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_13

```{r}
#| label: glmmTMB_13 newdata 13
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_13b
```{r}
#| label: glmmTMB_13 newdata 13b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
::::::
#### glmmTMB

```{r}
#| label: glmmTMB_13
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**

```{r}
#| label: glmmTMB_13_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: glmmTMB_13_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: glmmTMB_13_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Model Validation

```{r}
#| label: glmmTMB_13_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

```{r}
#| label: glmmTMB_13_dharma plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 4
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_13"
```

![](../output/figures/R_dharma_mod_glmmTMB_13.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_13_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_13"
mod_glmmTMB_13 <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_13.rds")
)
mod_glmmTMB_13 |> summary()
```

:::::

#### glmmTMB + coveriates

```{r}
#| label: glmmTMB_13b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
         
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: glmmTMB_13b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Southern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: glmmTMB_13b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_13b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Northern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: glmmTMB_13b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_13b_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_13b.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_13b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_13b"
mod_glmmTMB_13b <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_13b.rds")
)
mod_glmmTMB_13b |> summary()
```

:::::


#### brms

```{r}
#| label: brms_pre_13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_13
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: brms_13_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: brms_13_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: brms_13_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_trace_13.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_ac_13.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_rhat_13.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_ess_13.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_ppc_13.png){width=500px}

##### Summary

```{r}
#| label: brms_13_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
mod_brms_13 <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_13.rds")
)
mod_brms_13 |> summary()
```

:::::

#### brms + covariates

```{r}
#| label: brms_pre_13b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_13b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: brms_13b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Southern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: brms_13b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_13b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: brms_13b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_13b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13"
```

![](../output/figures/R_brms_trace_13b.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_13b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13b"
```

![](../output/figures/R_brms_ac_13b.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_13b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13b"
```

![](../output/figures/R_brms_rhat_13b.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_13b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_13b"
```

![](../output/figures/R_brms_ess_13b.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_13b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_13b"
```

![](../output/figures/R_brms_ppc_13b.png){width=500px}

##### Summary

```{r}
#| label: brms_13b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_13b"
mod_brms_13b <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_13b.rds")
)
mod_brms_13b |> summary()
```

:::::
 
#### stan

```{r}
#| label: stan_pre_13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: stan_13
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 13"
```


::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_stan_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_13_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: stan_13_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_stan_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_13_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Southern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: stan_13_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_stan_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_13_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Northern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: stan_13_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: stan_trace_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
```

![](../output/figures/R_stan_trace_13.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: stan_ac_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
```

![](../output/figures/R_stan_ac_13.png){width=500px}

###### Rhat

```{r}
#| label: stan_rhat_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
```

![](../output/figures/R_stan_rhat_13.png){width=500px}

###### Effective sample size

```{r}
#| label: stan_ess_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
```

![](../output/figures/R_stan_ess_13.png){width=500px}

::::::

##### Model validation

```{r}
#| label: stan_ppc_13
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
```

![](../output/figures/R_stan_ppc_13.png){width=500px}

##### Summary

```{r}
#| label: stan_13_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "stan_13"
mod_stan_13 <- readRDS(
  file = paste0(data_path, "synthetic/mod_stan_13.rds")
)
mod_stan_13$print(
  variables = c("phi", "beta", "sd_1", "sd_2", "sd_3"),
  max_rows = 20
)
mod_stan_13$print(
  variables = "cellmeans",
  max_rows = 20
)
```

:::::

#### GBM

```{r}
#| label: gbm_13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: gbm_13_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: gbm_13_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: gbm_13_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::
:::::
 
#### GBM + covariates

```{r}
#| label: gbm_13b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_13b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: gbm_13b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
![](../output/figures/R_infl_mod_gbm_13b.png){width=350px}

```{r}
#| label: gbm_pdp_13b_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
```{r}
#| label: pdp_pdp_13b_1 plot
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```


###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: gbm_13b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_13b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: gbm_13b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::


:::::

#### dbarts

```{r}
#| label: dbarts_13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{r}
#| label: dbarts_13_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 

###### Predict Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**
```{r}
#| label: dbarts_13_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_13.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::
Calculate MSE of predictions to **All Northern reefs**
```{r}
#| label: dbarts_13_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### dbarts + covariates

```{r}
#| label: dbarts_13b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Northern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**

```{r}
#| label: dbarts_13b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: dbarts_13b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_13b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: dbarts_13b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### xgboost + covariates
 
```{r}
#| label: xgboost_13_prep
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: xgboost_13_tune
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{r}
#| label: xgboost_13_fit
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_xgboost_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_13b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Southern sampled reefs**

```{r}
#| label: xgboost_13b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_xgboost_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_13b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{r}
#| label: xgboost_13b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_xgboost_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_13b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Northern reefs**

```{r}
#| label: xgboost_13b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### pymc-bart + covariates

```{python}
#| label: python sampled data barts data 13
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data barts fit 13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Southern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_1_mod_pymc_bart_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 13
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Southern sampled reefs**
```{python}
#| label: python sampled data pymc_barts mse 13b 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
  
###### Predicting Southern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_2_mod_pymc_bart_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 13 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 13 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Southern reefs**

```{python}
#| label: python sampled data pymc_barts mse 13b 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Northern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_3_mod_pymc_bart_13b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 13 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 13 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Northern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Northern reefs**

```{python}
#| label: python sampled data pymc_barts mse 13b 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### Comparisons


```{r}
#| label: comparison_13
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: false
```
  
::: {#fig-mse_13_1}
![](../output/figures/mse_13_1.png){width=700px}

Mean square error (MSE) of models build on Southern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Southern reefs, all Northern reefs or
only the sampled Southern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

::: {#fig-mse_13_2}
![](../output/figures/mse_13_2.png){width=700px}

Mean inaccuracy (%) of models build on Southern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller inaccuracy since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Southern reefs, all Northern reefs or
only the sampled Southern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

```{r}
#| label: comparison_13_tab
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: false
comps_13 <- readRDS(file = paste0(data_path,
                                        "synthetic/comps_13.rds")
                          ) 
comps_13 |> knitr::kable()
```
::::

:::

The following table lists datasets that are used in the comparison
figures along with their respective legend entries.

::: {.callout-note collapse=true}
### view table
| Dataset                                   | Description                                            | Target                             |
|-------------------------------------------|--------------------------------------------------------|------------------------------------|
| benthos_fixed_locs_obs_14                 | All Northern Reefs, Reef+ level with covariates        | incomplete_spatial_data_prep_14_   |
| benthos_benthos_reefs_temporal_summary_14 | Annual mean/median for All Northern reefs              | read_sampled_reefs_data_14_plot_2_ |
| newdata_14                                | Just the sampling years for Northern                   | incomplete_spatial_newdata_14_     |
| newdata_14b                               | All Northern Reefs, Reef level with covariates         | incomplete_spatial_newdata_14b_    |
| benthos_fixed_locs_obs_15                 | All Southern Reefs, Reef+ level with covariates        | incomplete_spatial_data_prep_15_   |
| benthos_benthos_reefs_temporal_summary_15 | Annual mean/median for All Southern reefs              | read_sampled_reefs_data_15_plot_2_ |
| newdata_15                                | Just the sampling years for Southern                   | incomplete_spatial_newdata_15_     |
| newdata_15b                               | All Southern Reefs, Reef level with covariates         | incomplete_spatial_newdata_15b_    |
| benthos_fixed_locs_obs_16                 | Northern sampled Reefs, Transect level with covariates | incomplete_spatial_data_prep_16_   |
| benthos_benthos_reefs_temporal_summary_16 | Annual mean/median for Sampled Northern reefs          | read_sampled_reefs_data_16_plot_2_ |
| newdata_16                                | Just the sampling years for Northern                   | incomplete_spatial_newdata_16_     |
| newdata_16b                               | Sampling Reef/years for Northern                       | incomplete_spatial_newdata_16b_    |
| benthos_fixed_locs_obs_17                 | Southern sampled Reefs, Transect level with covariates | incomplete_spatial_data_prep_17_   |
| benthos_benthos_reefs_temporal_summary_17 | Annual mean/median for Sampled Southern reefs          | read_sampled_reefs_data_17_plot_2_ |
| newdata_17                                | Just the sampling years for Southern                   | incomplete_spatial_newdata_17_     |
| newdata_17b                               | Sampling Reef/years for Southern                       | incomplete_spatial_newdata_17b_    |
|                                           |                                                        |                                    |
  
:::

Each of the sections below features a set of partial dependency plots.
These plots present the modelled temporal trends compared to a range
of other non-modelled estimates. The following table, defines each of
the trends presented throughout the partial plots. In the table,
**challenging data** refers to a dataset that has the focal modelling
challenge (for example, for the _Replace a reef_ issue, the
challenging data are observed data with a reef replacement.


| Trend                                                | Description                                                                       |
|------------------------------------------------------|-----------------------------------------------------------------------------------|
| `all mean`, `all median`, `true mean`, `true median` | Simple hierarchical means/medians for the full spatio-temporal grid (the "truth") |
| `all_sampled_ mean`, `all_sampled_ median`           | Simple hierarchical means/medians for the 25 sites / 12 years observational data  |
| `simple data mean`, `simple data median`             | Simple hierarchical means/medians for the **challenging data**                    |
| `glmmTMB`                                            | Modelled trends from a glmmTMB (frequentist) model                                |
| `brms`                                               | Modelled trends for a brms (Bayesian) model                                       |
| `stan`                                               | Modelled trends from a bespoke STAN (Bayesian) model                              |
| `gbm`                                                | Modelled trends from a Gradient Boosted Model (regression tree)                   |
| `dbarts`                                             | Modelled trends from a Bayesian Added Regression Tree                             |
| `xgboot`                                             | Modelled trends from a Gradient Boosted Model Tree                                |
| `pymc_bart`                                          | Modelled trends from a Bayesian Added Regression Tree                             |

Partial plots that display both a modelled trend as well as `simple
data mean` and `simple data median` allow us to compare how well the
model fits the training data.

Partial plots that display both a modelling trend as well as
`all_sampled_ mean`, `all_sampled_ median` and either `all mean`/`all
median` or `true mean`/`true median` allow us to compare the accuracy
of the model to both the full observed data and the full
spatio-temporal (truth) grid.


::: {.panel-tabset}

### Western sampled reefs

:::: {.panel-tabset}

#### Data sets

:::::: {.panel-tabset .tabset-left}

##### benthos_fixed_locs_obs_16
These are the **data** used to **fit the model**

```{r}
#| label: glmmTMB_16 sample data
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_14
These are the temporal **summaries** from the **All Northern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_16 sample data summary 14
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_15
These are the temporal **summaries** from the **All Southern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_16 sample data summary 15
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### newdata_14

```{r}
#| label: glmmTMB_16 newdata 14
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_14b 

```{r}
#| label: glmmTMB_16 newdata 14b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_15

```{r}
#| label: glmmTMB_16 newdata 15
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
  
##### newdata_15b

```{r}
#| label: glmmTMB_16 newdata 15b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_16

```{r}
#| label: glmmTMB_16 newdata 16
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_16b

```{r}
#| label: glmmTMB_16 newdata 16b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_17

```{r}
#| label: glmmTMB_16 newdata 17
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_17b
```{r}
#| label: glmmTMB_16 newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
::::::

#### glmmTMB

```{r}
#| label: glmmTMB_16
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: glmmTMB_16_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: glmmTMB_16_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: glmmTMB_16_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_16_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_16.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_16_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_16"
mod_glmmTMB_16 <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_16.rds")
)
mod_glmmTMB_16 |> summary()
```

:::::

#### glmmTMB + coveriates

```{r}
#| label: glmmTMB_16b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
         
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: glmmTMB_16b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Western reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: glmmTMB_16b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs
 
::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_16b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Eastern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: glmmTMB_16b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_16b_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_16b.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_16b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_16b"
mod_glmmTMB_16b <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_16b.rds")
)
mod_glmmTMB_16b |> summary()
```

:::::

#### brms

```{r}
#| label: brms_pre_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_16
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: brms_16_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: brms_16_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: brms_16_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_trace_16.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_ac_16.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_rhat_16.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_ess_16.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_ppc_16.png){width=500px}

##### Summary

```{r}
#| label: brms_16_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
mod_brms_16 <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_16.rds")
)
mod_brms_16 |> summary()
```

:::::

#### brms + covariates

```{r}
#| label: brms_pre_16b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_16b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: brms_16b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: brms_16b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_16b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Eastern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: brms_16b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_16b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16"
```

![](../output/figures/R_brms_trace_16b.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_16b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16b"
```

![](../output/figures/R_brms_ac_16b.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_16b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16b"
```

![](../output/figures/R_brms_rhat_16b.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_16b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_16b"
```

![](../output/figures/R_brms_ess_16b.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_16b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_16b"
```

![](../output/figures/R_brms_ppc_16b.png){width=500px}

##### Summary

```{r}
#| label: brms_16b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_16b"
mod_brms_16b <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_16b.rds")
)
mod_brms_16b |> summary()
```

:::::

#### stan

```{r}
#| label: stan_pre_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: stan_16
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 16"
```


::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_stan_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_16_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: stan_16_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_stan_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_16_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: stan_16_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_stan_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_16_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: stan_16_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: stan_trace_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
```

![](../output/figures/R_stan_trace_16.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: stan_ac_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
```

![](../output/figures/R_stan_ac_16.png){width=500px}

###### Rhat

```{r}
#| label: stan_rhat_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
```

![](../output/figures/R_stan_rhat_16.png){width=500px}

###### Effective sample size

```{r}
#| label: stan_ess_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
```

![](../output/figures/R_stan_ess_16.png){width=500px}

::::::

##### Model validation

```{r}
#| label: stan_ppc_16
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
```

![](../output/figures/R_stan_ppc_16.png){width=500px}

##### Summary

```{r}
#| label: stan_16_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "stan_16"
mod_stan_16 <- readRDS(
  file = paste0(data_path, "synthetic/mod_stan_16.rds")
)
mod_stan_16$print(
  variables = c("phi", "beta", "sd_1", "sd_2", "sd_3"),
  max_rows = 20
)
mod_stan_16$print(
  variables = "cellmeans",
  max_rows = 20
)
```

:::::


#### GBM

```{r}
#| label: gbm_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: gbm_16_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: gbm_16_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: gbm_16_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

:::::

#### GBM + covariates

```{r}
#| label: gbm_16b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_16b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: gbm_16b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

![](../output/figures/R_infl_mod_gbm_16b.png){width=350px}
  
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: gbm_16b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_16b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: gbm_16b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

:::::

#### dbarts

```{r}
#| label: dbarts_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: dbarts_pred_16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{r}
#| label: dbarts_16_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: dbarts_16_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_16.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: dbarts_16_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::

:::::

#### dbarts + covariates

```{r}
#| label: dbarts_16b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Western sampled reefs**

```{r}
#| label: dbarts_16b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: dbarts_16b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_16b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: dbarts_16b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### xgboost + covariates
 
```{r}
#| label: xgboost_16_prep
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: xgboost_16_tune
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{r}
#| label: xgboost_16_fit
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_xgboost_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_16b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Western sampled reefs**

```{r}
#| label: xgboost_16b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_xgboost_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_16b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: xgboost_16b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_xgboost_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_16b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: xgboost_16b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### pymc-bart + covariates

```{python}
#| label: python sampled data barts data 16
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data barts fit 16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Western sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_1_mod_pymc_bart_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
   
```{python}
#| label: python sampled data pymc_barts plot 16
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Western sampled reefs**
```{python}
#| label: python sampled data pymc_barts mse 16b 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_2_mod_pymc_bart_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 16 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 16 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**

```{python}
#| label: python sampled data pymc_barts mse 16b 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_3_mod_pymc_bart_16b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 16 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data pymc_barts plot 16 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{python}
#| label: python sampled data pymc_barts mse 16b 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::
   
##### Data sets

:::::: {.panel-tabset}

###### benthos_fixed_locs_obs_16

```{python}
#| label: python sampled data barts data 16 sample data
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

###### newdata_16b

```{python}
#| label: python sampled data barts data 16 newdata 16b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
###### newdata_17b

```{python}
#| label: python sampled data barts data 16 newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::
:::::
 
#### Comparisons
     
```{r}
#| label: comparison_16
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: false
```
 
::: {#fig-mse_16_1}
![](../output/figures/mse_16_1.png){width=800px}

Mean square error (MSE) of models build on Western reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Western reefs, all Eastern reefs or
only the sampled Western reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::


::: {#fig-mse_16_2}
![](../output/figures/mse_16_2.png){width=800px}

Mean inaccuracy (%) of models build on Western reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller inaccuracy since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Western reefs, all Eastern reefs or
only the sampled Western reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

```{r}
#| label: comparison_16_tab
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: false
comps_16 <- readRDS(file = paste0(data_path,
                                        "synthetic/comps_16.rds")
                          ) 
comps_16 |> knitr::kable()
```
      
  

::::

### Eastern sampled reefs

:::: {.panel-tabset}

#### Data sets

:::::: {.panel-tabset .tabset-left}

##### benthos_fixed_locs_obs_17
These are the **data** used to **fit the model**

```{r}
#| label: glmmTMB_17 sample data
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_14
These are the temporal **summaries** from the **All Northern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_17 sample data summary 14
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### benthos_reefs_temporal_summary_15
These are the temporal **summaries** from the **All Southern reefs**
used to represent "simple data mean" and "simple data median" in
**partial dependency plots**

```{r}
#| label: glmmTMB_17 sample data summary 15
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

##### newdata_14

```{r}
#| label: glmmTMB_17 newdata 14
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_14b 

```{r}
#| label: glmmTMB_17 newdata 14b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_15

```{r}
#| label: glmmTMB_17 newdata 15
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
  
##### newdata_15b

```{r}
#| label: glmmTMB_17 newdata 15b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_17

```{r}
#| label: glmmTMB_17 newdata 17
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_17b

```{r}
#| label: glmmTMB_17 newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_16

```{r}
#| label: glmmTMB_17 newdata 16
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
##### newdata_16b
```{r}
#| label: glmmTMB_17 newdata 16b
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
    
::::::

#### glmmTMB

```{r}
#| label: glmmTMB_17
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: glmmTMB_17_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: glmmTMB_17_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: glmmTMB_17_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_17_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_17.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_17_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_17"
mod_glmmTMB_17 <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_17.rds")
)
mod_glmmTMB_17 |> summary()
```

:::::

#### glmmTMB + coveriates

```{r}
#| label: glmmTMB_17b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```
         
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_glmmTMB_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- sampled reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: glmmTMB_17b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_glmmTMB_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Eastern reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: glmmTMB_17b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs
 
::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_glmmTMB_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: glmmTMB_17b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by predicting to the level of
reef/year (with covariates) and then averaging (with HDI) to year
level.

- All Western reefs (blue and green dashed lines)
- glmmTMB modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: glmmTMB_17b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

##### Model Validation

```{r}
#| label: glmmTMB_17b_dharma
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| cache: false
#| code-fold: true
```

![](../output/figures/R_dharma_mod_glmmTMB_17b.png){width=500px}

##### Summary

```{r}
#| label: glmmTMB_17b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "glmmTMB_17b"
mod_glmmTMB_17b <- readRDS(
  file = paste0(data_path, "synthetic/mod_glmmTMB_17b.rds")
)
mod_glmmTMB_17b |> summary()
```

:::::

#### brms

```{r}
#| label: brms_pre_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_17
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: brms_17_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: brms_17_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: brms_17_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_trace_17.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_ac_17.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_rhat_17.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_ess_17.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_ppc_17.png){width=500px}

##### Summary

```{r}
#| label: brms_17_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
mod_brms_17 <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_17.rds")
)
mod_brms_17 |> summary()
```

:::::

#### brms + covariates

```{r}
#| label: brms_pre_17b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: brms_17b
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data"
```

::::: {.panel-tabset}
##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_brms_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: brms_17b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_brms_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Eastern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: brms_17b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_brms_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: brms_17b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: brms_17b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: brms_trace_17b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17"
```

![](../output/figures/R_brms_trace_17b.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: brms_ac_17b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17b"
```

![](../output/figures/R_brms_ac_17b.png){width=500px}

###### Rhat

```{r}
#| label: brms_rhat_17b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17b"
```

![](../output/figures/R_brms_rhat_17b.png){width=500px}

###### Effective sample size

```{r}
#| label: brms_ess_17b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "brms_17b"
```

![](../output/figures/R_brms_ess_17b.png){width=500px}

::::::

##### Model validation

```{r}
#| label: brms_ppc_17b
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "brms_17b"
```

![](../output/figures/R_brms_ppc_17b.png){width=500px}

##### Summary

```{r}
#| label: brms_17b_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "brms_17b"
mod_brms_17b <- readRDS(
  file = paste0(data_path, "synthetic/mod_brms_17b.rds")
)
mod_brms_17b |> summary()
```

:::::

#### stan

```{r}
#| label: stan_pre_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: stan_17
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "read sampled reefs data 17"
```


::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_stan_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_17_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- sampled reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: stan_17_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_stan_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_17_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Eastern reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: stan_17_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_stan_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: stan_17_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies based on estimated marginalised means for year

- All Western reefs (blue and green dashed lines)
- stan modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: stan_17_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```


::::::

##### Sampling diagnostics

:::::: {.panel-tabset}

###### Traceplots

```{r}
#| label: stan_trace_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
```

![](../output/figures/R_stan_trace_17.png){width=500px}

###### Autocorrelation plots

```{r}
#| label: stan_ac_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
```

![](../output/figures/R_stan_ac_17.png){width=500px}

###### Rhat

```{r}
#| label: stan_rhat_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
```

![](../output/figures/R_stan_rhat_17.png){width=500px}

###### Effective sample size

```{r}
#| label: stan_ess_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 10
#| fig-height: 8
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
```

![](../output/figures/R_stan_ess_17.png){width=500px}

::::::

##### Model validation

```{r}
#| label: stan_ppc_17
#| results: markup
#| eval: false
#| echo: true
#| fig-width: 8
#| fig-height: 6
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
```

![](../output/figures/R_stan_ppc_17.png){width=500px}

##### Summary

```{r}
#| label: stan_17_summary
#| results: markup
#| echo: true
#| code-fold: true
#| cache: true
#| dependson: "stan_17"
mod_stan_17 <- readRDS(
  file = paste0(data_path, "synthetic/mod_stan_17.rds")
)
mod_stan_17$print(
  variables = c("phi", "beta", "sd_1", "sd_2", "sd_3"),
  max_rows = 20
)
mod_stan_17$print(
  variables = "cellmeans",
  max_rows = 20
)
```

:::::

#### GBM

```{r}
#| label: gbm_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: gbm_17_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: gbm_17_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of year (without covariates)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: gbm_17_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::::

:::::

#### GBM + covariates

```{r}
#| label: gbm_17b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: gbm_post_17b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_gbm_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: gbm_17b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

![](../output/figures/R_infl_mod_gbm_17b.png){width=350px}
  
###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_gbm_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: gbm_17b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_gbm_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: gbm_17b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating (median) within each year (e.g. averaging over reefs)

- sampled reefs (blue and green dashed lines)
- gbm modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: gbm_17b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::


:::::

#### dbarts

```{r}
#| label: dbarts_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: dbarts_pred_17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{r}
#| label: dbarts_17_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**
```{r}
#| label: dbarts_17_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
###### Predict Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_17.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level year/.draw 
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
```{r}
#| label: dbarts_17_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::

:::::

#### dbarts + covariates

```{r}
#| label: dbarts_17b
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_dbarts_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Eastern sampled reefs**

```{r}
#| label: dbarts_17b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_dbarts_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: dbarts_17b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_dbarts_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: dbarts_17b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: dbarts_17b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### xgboost + covariates
 
```{r}
#| label: xgboost_17_prep
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{r}
#| label: xgboost_17_tune
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{r}
#| label: xgboost_17_fit
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_1_mod_xgboost_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_17b_pred_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::


Calculate MSE of predictions to **Eastern sampled reefs**

```{r}
#| label: xgboost_17b_mse_1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_2_mod_xgboost_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_17b_pred_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{r}
#| label: xgboost_17b_mse_2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/R_pdp_3_mod_xgboost_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{r}
#| label: xgboost_17b_pred_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:
- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- sampled reefs (blue and green dashed lines)
- xgboost modelled estimates (orange ribbon, white line)
::::
:::
 
Calculate MSE of predictions to **All Western reefs**

```{r}
#| label: xgboost_17b_mse_3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::

:::::

#### pymc-bart + covariates

```{python}
#| label: python sampled data barts data 17
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data barts fit 17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::: {.panel-tabset}

##### Partial dependency plot

:::::: {.panel-tabset}

###### Eastern sampled reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_1_mod_pymc_bart_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
   
```{python}
#| label: python sampled data pymc_barts plot 17
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
- sampled reefs (blue and green dashed lines)
- dbarts modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **Eastern sampled reefs**
```{python}
#| label: python sampled data pymc_barts mse 17b 1
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Eastern reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_2_mod_pymc_bart_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 17 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

```{python}
#| label: python sampled data pymc_barts plot 17 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Eastern reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Eastern reefs**

```{python}
#| label: python sampled data pymc_barts mse 17b 2
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

###### Predicting Western reefs

::: {.columns}
:::: {.column width="50%"}
![](../output/figures/python_pdp_3_mod_pymc_bart_17b.png){width=350px}
::::
:::: {.column width="50%"}
```{python}
#| label: python sampled data pymc_barts prep plot 17 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
 
```{python}
#| label: python sampled data pymc_barts plot 17 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```

Partial dependencies calculated by:

- predicting to the level of reef/year (with covariates)
- aggregating within each year/.draw (e.g. averaging over reefs)
- averaging (with HDI) to year level.

- All Western reefs (blue and green dashed lines)
- brms modelled estimates (orange ribbon, white line)
::::
:::

Calculate MSE of predictions to **All Western reefs**
 
```{python}
#| label: python sampled data pymc_barts mse 17b 3
#| results: markup
#| eval: false
#| echo: true
#| cache: false
#| code-fold: true
```
::::::
   
##### Data sets

:::::: {.panel-tabset}

###### benthos_fixed_locs_obs_17

```{python}
#| label: python sampled data barts data 17 sample data
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```

###### newdata_17b

```{python}
#| label: python sampled data barts data 17 newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
###### newdata_17b

```{python}
#| label: python sampled data barts data 17 newdata 17b
#| results: markup
#| eval: true
#| echo: true
#| cache: false
#| code-fold: true
```
 
::::::
:::::
 
#### Comparisons
     
```{r}
#| label: comparison_17
#| results: markup
#| eval: false
#| echo: true
#| code-fold: true
#| cache: false
```
 
::: {#fig-mse_17_1}
![](../output/figures/mse_17_1.png){width=800px}

Mean square error (MSE) of models build on Eastern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller error since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Eastern reefs, all Western reefs or
only the sampled Eastern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::


::: {#fig-mse_17_2}
![](../output/figures/mse_17_2.png){width=800px}

Mean inaccuracy (%) of models build on Eastern reefs data (25
reefs) and compared to either reef/year level data. This represents
the models' ability to represent median-scale spatio-temporal
patterns. Smaller values imply smaller inaccuracy since predicted values
are closer to the observed values. Panel columns condition MSE into
predicting data from either all Eastern reefs, all Western reefs or
only the sampled Eastern reefs. Panel rows condition MSE into whether
models contained covariates or not.

:::

```{r}
#| label: comparison_17_tab
#| results: markup
#| eval: true
#| echo: true
#| code-fold: true
#| cache: false
comps_17 <- readRDS(file = paste0(data_path,
                                        "synthetic/comps_17.rds")
                          ) 
comps_17 |> knitr::kable()
```
      
  
::::

:::
 
    
    
